@page "/SukkotAdmin/DonationsGrid/"

@using static LivingMessiah.Web.Services.Auth0
@using LivingMessiah.Web.Shared.Sukkot

@using LivingMessiah.Web.Pages.SukkotAdmin.Donations.Domain
@using LivingMessiah.Web.Pages.SukkotAdmin.Donations.Data

@using SukkotApi.Domain.Donations.Enums
@using SukkotApi.Domain.Enums
@using SukkotApi.Domain.Registrations.Enums

@using Grid = Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Data

<AuthorizeView Roles="@Roles.SukkotMenuBar">
	<SukkotAdminMenubar></SukkotAdminMenubar>
</AuthorizeView>

<div class="pb-2 mt-4 mb-4 border-bottom">
	<h3><i class="fas fa-dollar-sign"></i> Donation Data Grid</h3>
</div>

@foreach (var item in BaseDonationStatusFilterSmartEnum.List.OrderBy(o => o.Value))
{
	<a @onclick="@(() => OnClickFilter(item))" title="Filter by @item.ButtonName"
		 class="btn btn-outline-primary btn-sm @ActiveFilter(item)">
		@item.ButtonName &nbsp;<i class="fas fa-chevron-circle-right"></i>
	</a>
}

<TableHeaderExplanation></TableHeaderExplanation>

<div class="col-lg-12 control-section">
	<div class="content-wrapper">
		<div class="row">

			<SfGrid ID="Grid" @ref="DefaultGrid" SelectedRowIndex=2
							DataSource="@DonationReportList"
							Toolbar="@(new List<string>() { "Print", "ExcelExport" })"
							AllowSorting="true"
							AllowExcelExport="true">
				<GridSortSettings>
					<GridSortColumns>
						<GridSortColumn Field="@nameof(DonationReport.FirstName)" Direction="SortDirection.Ascending"></GridSortColumn>
					</GridSortColumns>
				</GridSortSettings>
				<GridEvents OnToolbarClick="ToolbarClickHandler"
										RowSelected="RowSelecthandler" QueryCellInfo="CustomizeCell"
										TValue="DonationReport">
				</GridEvents>
				<GridColumns>
					<GridColumn Field=@nameof(DonationReport.Id) HeaderText="Id" Width="35" AllowSorting="true"> </GridColumn>
					<GridColumn Field=@nameof(DonationReport.FirstName) HeaderText="First Name" Width="70" AllowSorting="true"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.FamilyName) HeaderText="Last Name" Width="70" AllowSorting="true"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.EMail) HeaderText="Email" Width="80" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.StatusId) HeaderText="SID" Width="40" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.LocationName) HeaderText="Location" Width="60" AllowSorting="true"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.RegistrationFee) HeaderText="Reg. Fee" Width="60" Format="c0" TextAlign="TextAlign.Right" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.CampCost) HeaderText="Lodging" Width="60" Format="c0" TextAlign="TextAlign.Right" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.TotalDonation) HeaderText="Total" Width="60" Format="c0" TextAlign="TextAlign.Right" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.AmountDue) HeaderText="Amount Due" Width="60" Format="c0" TextAlign="TextAlign.Right" AllowSorting="false"></GridColumn>
					<GridColumn Field=@nameof(DonationReport.FullyPaidIcon) HeaderText="FP" Width="60" Format="c0" TextAlign="TextAlign.Center" AllowSorting="false">
						<HeaderTemplate>
							<div>
								<i class="fas fa-check"></i>
							</div>
						</HeaderTemplate>
					</GridColumn>
				</GridColumns>
			</SfGrid>

			<div class="e-statustext badge badge-info mt-3">Detail Donations Records for <b>@SelectedRegistrant</b></div>

			<SfGrid DataSource="@DonationDetails" Query="@(new Query().Where("Id", "equal", RowIndex))"
							Toolbar="@(new List<string>() { "Add", "Update", "Cancel" })">

				@* Toolbar="@(new List<string>() { "Add", "Edit", "Update", "Delete", "Cancel" })"> *@

				<GridEditSettings AllowEditing="false" AllowAdding="true" AllowDeleting="false" ShowConfirmDialog="false" />
				<SfDataManager AdaptorInstance="typeof(SyncFusionAdaptor)" Adaptor="Adaptors.CustomAdaptor"></SfDataManager>
				<GridColumns>

					<GridColumn Field="@nameof(DonationDetail.Id)" IsPrimaryKey="true" Visible="false"></GridColumn>

					<GridColumn Field="@nameof(DonationDetail.RegistrationId)" Visible="false"></GridColumn>
					<GridColumn Field=@nameof(DonationDetail.Detail) HeaderText="#" Width="25" AllowAdding="false" AllowEditing="false"> </GridColumn>

					<GridColumn Field=@nameof(DonationDetail.Amount) HeaderText="Amount"
											ValidationRules="@(new Grid.ValidationRules{ Required=true, Range = new double[]{1, 1000}})"
											Width="110" Format="c0" TextAlign="TextAlign.Right">
					</GridColumn>

					<GridColumn Field=@nameof(DonationDetail.Notes) HeaderText="Notes" Width="110"></GridColumn>

					<GridColumn Field=@nameof(DonationDetail.ReferenceId) HeaderText="Reference" Width="70"
											ValidationRules="@(new Grid.ValidationRules{ Required=true})">
					</GridColumn>

					<GridColumn Field=@nameof(DonationDetail.CreateDate) HeaderText="Date"
											ValidationRules="@(new Grid.ValidationRules{ Required=true})"
											EditType="EditType.DatePickerEdit" Format="d" Type="ColumnType.Date" TextAlign="TextAlign.Right" Width="70">
					</GridColumn>

				</GridColumns>
			</SfGrid>

		</div>
	</div>
</div>

<style>
	.e-statustext {
		font-size: 20px;
	}
</style>

@if (DatabaseError)
{
	<p class="text-danger"><em>@DatabaseErrorMsg</em></p>
}
else
{
	if (DatabaseWarning)
	{
		<p class="text-warning">@DatabaseWarningMsg</p>
	}
}
