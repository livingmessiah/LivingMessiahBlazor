@page "/SukkotAdmin/RegistrationList/"
@using LivingMessiah.Web.Pages.Sukkot.CreateEdit
@using SukkotApi.Domain.Registrations.Enums
@using static LivingMessiah.Web.Services.Auth0
@using LivingMessiah.Web.Shared.Sukkot
@using LivingMessiah.Web.Infrastructure
@using LivingMessiah.Web.Settings
@using Microsoft.Extensions.Options
@using NB = LivingMessiah.Web.Shared.Sukkot.Enums

<AuthorizeView Roles="@Roles.SukkotMenuBar">
	<SukkotAdminMenubar></SukkotAdminMenubar>
</AuthorizeView>

@using Page = LivingMessiah.Web.Links.Sukkot
<PageTitle>@Page.RegistrationListTitle</PageTitle>

<div class="pb-2 mt-4 mb-4 border-bottom">
	<h3><i class="fas fa-table"></i> @Page.RegistrationListTitle</h3>
</div>

<AuthorizeView Roles="@Roles.AdminOrSukkot">
	<div class="row">
		<div class="col-12">
			<CommonButtons RegistrationStepId="null"
										 NavButton="NB.NavButton.Add">
			</CommonButtons>
		</div>
	</div>

</AuthorizeView>

<LoadingComponent IsLoading="Registrations == null">
	@if (!Registrations.Any())
	{
		<h3 class="text-danger">No Registrations</h3>
	}
	else
	{
		<p class="text-muted mb-1 float-end"><small>@GetTitle()</small></p>
		<div class="table-responsive">
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>
							<span class="sort-link" @onclick=@(() => SortClicked(RegistrationSortEnum.Id))>Id</span>
							<span>@(GetSortStyle(RegistrationSortEnum.Id))</span>
							<br />&nbsp;
						</th>
						<th>
							<span class="sort-link" @onclick=@(() => SortClicked(RegistrationSortEnum.FirstName))>First Name</span>
							<span>@(GetSortStyle(RegistrationSortEnum.FirstName))</span>
							&nbsp;|&nbsp;
							<span class="sort-link" @onclick=@(() => SortClicked(RegistrationSortEnum.LastName))>Last Name</span>
							<span>@(GetSortStyle(RegistrationSortEnum.LastName))</span>
							<br />Name / EMail / Phone
						</th>
						<th>
							Registration
							<br />&nbsp;
						</th>
						<th>
							Donation / Status
							<br />&nbsp;
						</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Registrations)
					{
						<tr>
							<td>@item.Id</td>
							<td>@StringExtensions.Truncate(item.FullName(false), 30)<br />@item.EMail<br />@item.Phone</td>


							<AuthorizeView Roles="@Roles.AdminOrSukkot">
								<Authorized>
									<td>
										<div class="btn-group">
											<CommonButtons RegistrationStepId="item.Id"
																 NavButton="NB.NavButton.Details">
											</CommonButtons>
											<CommonButtons RegistrationStepId="item.Id"
																 NavButton="NB.NavButton.Edit">
											</CommonButtons>
											<CommonButtons RegistrationStepId="item.Id"
																 NavButton="NB.NavButton.DeleteConfirmation">
											</CommonButtons>
										</div>
									</td>

									<td>

										<div class="btn-group">
											<CommonButtons RegistrationStepId="item.Id"
																 NavButton="NB.NavButton.Donation">
											</CommonButtons>
										</div>

										<div class=mt-2>
											<sup>@item.StatusId</sup>  @StringExtensions.Truncate(item.StatusName, 30)
										</div>

									</td>

								</Authorized>

								<NotAuthorized>
									<td>
										<div class="btn-group">
											<CommonButtons RegistrationStepId="item.Id"
																 NavButton="NB.NavButton.Details">
											</CommonButtons>
										</div>
									</td>
									<td></td>
								</NotAuthorized>
							</AuthorizeView>

						</tr>
					}

					<tr>
						<td><h2><span class="badge bg-success"><b>@RecordCount</b></span></h2></td>
						<td><h2><span class="badge bg-success">Total</span></h2></td>
						<td colspan="3">&nbsp;</td>
					</tr>

				</tbody>
			</table>
		</div>

	}

</LoadingComponent>

@if (DatabaseError)
{
	<p class="text-danger"><em>@DatabaseErrorMsg</em></p>
}
else
{
	if (DatabaseWarning)
	{
		<p class="text-warning">@DatabaseWarningMsg</p>
	}
	else
	{
		if (DatabaseInformation)
		{
			<p class="text-info">@DatabaseInformationMsg</p>
		}
	}
}



