@page "/Sukkot/RegistrationSteps"
@page "/Sukkot/RegistrationShell"

@using Microsoft.AspNetCore.Hosting;
@using Microsoft.Extensions.Hosting;
@using LivingMessiah.Web.Shared.Sukkot
@using static LivingMessiah.Web.Services.Auth0

@using SukkotApi.Domain.Enums
@using LivingMessiah.Web.Pages.Sukkot.Constants

@using PageHome = LivingMessiah.Web.Links.Sukkot
@using Page = LivingMessiah.Web.Links.Sukkot.RegistrationSteps
<PageTitle>@Page.Title</PageTitle>

<div class="pb-2 mt-4 mb-2 border-bottom">
	<h2><i class="@Page.Icon"></i> @Page.Title</h2>
</div>

@*<AuthorizeView Roles="@Roles.SukkotMenuBar">
	<SukkotAdminMenubar></SukkotAdminMenubar>
	</AuthorizeView>
*@


@if (AttemptingToGetRecord == true)
{
	<div class="spinner-border"></div>
	<span style="display: inline-block; vertical-align: super">Loading...</span>
}
else
	@if (!String.IsNullOrWhiteSpace(AttemptingToGetRecordMsg))
{
	<p class="text-danger"><em>@AttemptingToGetRecordMsg</em></p>
}
else
{
	<IndexVMDump IndexVM=@IndexVM />

	<h4 class="mb-3">To register for Sukkot, you must complete these steps</h4>

	<div class="row">
		<div class="col-sm-1">
			<h5><span class="badge badge-warning">Step</span></h5>
		</div>
		<div class="col-sm-1">
			<h5><span class="badge badge-warning">Done</span></h5>
		</div>
		<div class="col-sm-10">
			<h5><span class="badge badge-warning">Description</span></h5>
		</div>
	</div>


	<div class="row">

		<div class="col-sm-1">
			<i class="fa-2x">@Status.EmailNotConfirmed.StepNumber</i>
		</div>
		<div class="col-sm-1">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.EmailConfirmation) == true)
			{
				<i class="fas fa-check fa-3x"></i>
			}
		</div>

		<div class="col-sm-10">
			<h4>Task - Getting Started</h4>
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.EmailConfirmation) == true)
			{
				<p class="lead"><b>Task completed</b></p>
			}
			else
			{
				<p class="lead">
					Print out this
					<a href="@LivingMessiah.Web.Pages.Sukkot.Constants.Blobs.UrlPDF(PDFs.RegistrationWalkThrough)"
				 class="btn btn-primary btn-sm" target="_blank">
						<i class="fas fa-file-pdf"></i> PDF
					</a> or leave it open in another window as it will be helpful with the next step.
				</p>
			}
		</div>

	</div>

	<hr />

	<div class="row">
		<div class="col-sm-1">
			<i class="fa-2x">@Status.EmailConfirmation.StepNumber</i>
		</div>
		<div class="col-sm-1">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.EmailConfirmation) == true)

			{
				<i class="fas fa-check fa-3x"></i>
			}
		</div>

		<div class="col-sm-10">
			<h4>Task - Living Messiah Account</h4>
			<Step2EmailVerified StatusFlag="@IndexVM.StatusFlag"></Step2EmailVerified>
		</div>
	</div>

	<hr />

	<div class="row">
		<div class="col-sm-1">
			<i class="fa-2x">@Status.AcceptedHouseRulesAgreement.StepNumber</i>
		</div>
		<div class="col-sm-1">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.AcceptedHouseRulesAgreement) == true)
			{
				<i class="fas fa-check fa-3x"></i>
			}
		</div>

		<div class="col-sm-10">
			<h4>Task - Sign Agreement</h4>
			<Step3AcceptedHouseRulesAgreement StatusFlag="@IndexVM.StatusFlag"
																			EmailAddress="@IndexVM.EmailAddress"
																			IsXs="false">
			</Step3AcceptedHouseRulesAgreement>

		</div>
	</div>


	<hr />

	<div class="row">
		<div class="col-sm-1">
			<i class="fa-2x">@Status.RegistrationFormCompleted.StepNumber</i>
		</div>

		<div class="col-sm-1">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.RegistrationFormCompleted) == true)
			{
				<i class="fas fa-check fa-3x"></i>
			}
		</div>

		<div class="col-sm-10">
			<h4>Task - Registration</h4>

			@*the AndAlso seems redundant*@
			@if (IndexVM.RegistrationStep is not null && IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.AcceptedHouseRulesAgreement) == true)
			{
				<Step4Registration IsXs="false"
											 RegistrationId="@IndexVM.RegistrationStep.Id"
											 StatusFlag="@IndexVM.StatusFlag">
				</Step4Registration>
			}
		</div>
	</div>


	<hr />

	<div class="row">
		<div class="col-sm-1">
			<i class="fa-2x">@Status.PartiallyPaid.StepNumber</i>
		</div>

		<div class="col-sm-1">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.FullyPaid) == true)
			{
				<i class="fas fa-check fa-3x"></i>
			}
			else
			{
				@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.PartiallyPaid) == true)
				{
					<i class="fas fa-star-half fa-3x text-muted"></i>
				}
			}
		</div>

		<div class="col-sm-10">
			@if (IndexVM.StatusFlag.HasFlag(Enums.StatusFlag.PartiallyPaid) == true)
			{
				<h4>Task - Payment (partial)</h4>
			}
			else
			{
				<h4>Task - Payment</h4>
			}
			@if (IndexVM.RegistrationStep is not null)
			{
				<Step5Payment StatusFlag="IndexVM.StatusFlag"
									RegistrationStep="IndexVM.RegistrationStep">
				</Step5Payment>
			}


		</div>
	</div>


	<div class="row mt-4 pt-1 border-top">
		<div class="col-12">
			<a href="@PageHome.Index"
			 title="Sukkot Introduction" class="btn-info btn-sm">
				<i class="far fa-arrow-alt-circle-left"></i> Back to Introduction
			</a>
		</div>
	</div>

	@if (DatabaseError)
	{
		<p class="text-danger"><em>@DatabaseErrorMsg</em></p>
	}
	else
	{
		if (DatabaseWarning)
		{
			<p class="text-warning">@DatabaseWarningMsg</p>
		}
		else
		{
			if (DatabaseInformation)
			{
				<p class="text-info">@DatabaseInformationMsg</p>
			}
		}
	}

}

